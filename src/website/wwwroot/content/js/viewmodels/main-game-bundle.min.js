var mainGameModel=function(e){var a=this;a.gameStarted=ko.observable(!1),a.currentQuarter=ko.observable(1),a.currentQuarterDisplay=ko.computed(function(){return getNumberWithEnding(a.currentQuarter())}),a.currentDown=ko.observable(1),a.ballSpotStart=ko.observable(0),a.yardsTraveled=ko.observable(0),a.yardsToFirst=ko.observable(10),a.yardsToTouchdown=ko.computed(function(){return 100-(a.ballSpotStart()+a.yardsTraveled())}),a.currentBallSpot=ko.computed(function(){let e=a.yardsToTouchdown();return e>50&&(e=100-e),e}),a.playCountForPossession=ko.observable(1),a.timeOfPossession=ko.observable(0),a.hasRolled=ko.observable(!1),a.currentTeamWithBall=ko.observable(0),a.teamPlayHistory=ko.observableArray(),a.gamePlayStats=ko.observableArray(),a.gameBoxScore=ko.observableArray(),a.needCoinToss=ko.observable(!0),a.CloseSpecialTeamsMenu=function(){$("#specialTeamsMenu").removeClass(MODULES.Constants.SHOW_SPECIAL_TEAMS_CLASS)},a.ClearCoinColors=function(){$(".side-a").removeClass(a.homeTeamInfo().teamBgColor()),$(".side-b").removeClass(a.homeTeamInfo().teamBgColor()),$(".side-a").removeClass(a.awayTeamInfo().teamBgColor()),$(".side-b").removeClass(a.awayTeamInfo().teamBgColor())},a.ChooseCoinSide=function(){return a.ClearCoinColors(),1===parseInt($("input[name=selectCoinSide]:checked").val(),10)?($(".side-a").addClass(a.awayTeamInfo().teamBgColor()),$("#side-a-txt").text(a.awayTeamInfo().teamName()),$(".side-b").addClass(a.homeTeamInfo().teamBgColor()),$("#side-b-txt").text(a.homeTeamInfo().teamName())):($(".side-b").addClass(a.awayTeamInfo().teamBgColor()),$("#side-b-txt").text(a.awayTeamInfo().teamName()),$(".side-a").addClass(a.homeTeamInfo().teamBgColor()),$("#side-a-txt").text(a.homeTeamInfo().teamName())),!0},a.vm=ko.observable(e)};$(function(){ko.bindingHandlers.class={update:function(e,a){e.__ko__previousClassValue__&&$(e).removeClass(e.__ko__previousClassValue__);var o=ko.utils.unwrapObservable(a());$(e).addClass(o),e.__ko__previousClassValue__=o}},ko.observableArray.fn.refresh=function(e){var a=this.indexOf(e);a>=0&&(this.splice(a,1),this.splice(a,0,e))},ko.applyBindings(function(){var e=this;e.gameStarted=ko.observable(!1),e.currentQuarter=ko.observable(1),e.currentQuarterDisplay=ko.computed(function(){return getNumberWithEnding(e.currentQuarter())}),e.currentDown=ko.observable(1),e.ballSpotStart=ko.observable(0),e.yardsTraveled=ko.observable(0),e.yardsToFirst=ko.observable(10),e.yardsToTouchdown=ko.computed(function(){return 100-(e.ballSpotStart()+e.yardsTraveled())}),e.currentBallSpot=ko.computed(function(){let a=e.yardsToTouchdown();return a>50&&(a=100-a),a}),e.playCountForPossession=ko.observable(1),e.timeOfPossession=ko.observable(0),e.hasRolled=ko.observable(!1),e.currentTeamWithBall=ko.observable(0),e.teamPlayHistory=ko.observableArray(),e.gamePlayStats=ko.observableArray(),e.gameBoxScore=ko.observableArray(),e.needCoinToss=ko.observable(!0),e.CloseSpecialTeamsMenu=function(){$("#specialTeamsMenu").removeClass(MODULES.Constants.SHOW_SPECIAL_TEAMS_CLASS)},e.ClearCoinColors=function(){$(".side-a").removeClass(e.homeTeamInfo().teamBgColor()),$(".side-b").removeClass(e.homeTeamInfo().teamBgColor()),$(".side-a").removeClass(e.awayTeamInfo().teamBgColor()),$(".side-b").removeClass(e.awayTeamInfo().teamBgColor())},e.ChooseCoinSide=function(){return e.ClearCoinColors(),1===parseInt($("input[name=selectCoinSide]:checked").val(),10)?($(".side-a").addClass(e.awayTeamInfo().teamBgColor()),$("#side-a-txt").text(e.awayTeamInfo().teamName()),$(".side-b").addClass(e.homeTeamInfo().teamBgColor()),$("#side-b-txt").text(e.homeTeamInfo().teamName())):($(".side-b").addClass(e.awayTeamInfo().teamBgColor()),$("#side-b-txt").text(e.awayTeamInfo().teamName()),$(".side-a").addClass(e.homeTeamInfo().teamBgColor()),$("#side-a-txt").text(e.homeTeamInfo().teamName())),!0},e.homeTeamID=ko.observable(0),e.homeTeamInfo=ko.computed(function(){return"undefined"===e.homeTeamID()||e.homeTeamID()<=0?new MODULES.Constructors.TeamArrayRecord:($.grep(MODULES.GameVariables.Teams,function(a){return a.teamId===e.homeTeamID()})[0],$.grep(MODULES.GameVariables.Teams,function(a){return a.teamId===e.homeTeamID()})[0])}),e.homeTeamTimeOuts=ko.observable(3),e.homeTeamScore=ko.observable(0),e.awayTeamID=ko.observable(0),e.awayTeamInfo=ko.computed(function(){return"undefined"===e.awayTeamID()||e.awayTeamID()<=0?new MODULES.Constructors.TeamArrayRecord:($.grep(MODULES.GameVariables.Teams,function(a){return a.teamId===e.awayTeamID()})[0],$.grep(MODULES.GameVariables.Teams,function(a){return a.teamId===e.awayTeamID()})[0])}),e.awayTeamTimeOuts=ko.observable(3),e.awayTeamScore=ko.observable(0),e.currentTeamHasTimeOuts=ko.computed(function(){return e.currentTeamWithBall()===e.awayTeamID()&&e.awayTeamTimeOuts()>0||e.currentTeamWithBall()===e.homeTeamID()&&e.homeTeamTimeOuts()>0}),e.timerId=0,e.elapsedTime=ko.observable(0),e.initialTime=ko.observable(MODULES.Constants.MAX_TIME_OF_QUARTER),e.remainingTime=ko.computed(function(){return e.initialTime()-e.elapsedTime()}),e.remainingTimeDisplay=ko.computed(function(){return UTILITIES.getTimeDisplay(e.remainingTime())}),e.isRunning=ko.observable(!1),e.StartCounter=function(){e.isRunning(!0),e.timerId=window.setInterval(function(){e.elapsedTime(e.elapsedTime()+1),0===e.remainingTime()&&(clearInterval(e.timerId),e.isRunning(!1),e.Callback())},MODULES.GameVariables.TimeIntervalCountDown)},e.StopCounter=function(){clearInterval(e.timerId),e.isRunning(!1)},e.Callback=function(){},e.teamsPicked=ko.computed(function(){let a=!1;return homeTeamID()&&awayTeamID()&&homeTeamID()>0&&awayTeamID()>0&&(a=!0),e.ChooseCoinSide(),a}),e.SetupKickoffBallSpot=function(){if(console.log("SETTING UP KICKOFF BALL SPOT"),console.log("isExtraPointKick: %s, isKickoff: %s, isSafety: %s",isExtraPointKick(),isKickoff(),isSafety()),isExtraPointKick()||isKickoff()||isSafety()){let a=MODULES.Constants.KICKOFF_SPOT;isKickoff()&&(console.log("SPOT BEFORE CHANGE (KICKOFF): %s",a),a+=30),isSafety()&&(a=MODULES.Constants.SAFETY_KICKOFF_SPOT,console.log("SPOT BEFORE CHANGE (SAFETY): %s",a),a+=60),isExtraPointKick()&&(a=MODULES.Constants.EXTRA_POINT_KICK_SPOT,console.log("SPOT BEFORE CHANGE (EXTRA POINT): %s",a)),e.ballSpotStart(a)}return console.log("just return ball spot: %s",e.ballSpotStart()),e.SetBallPosition(),e.ballSpotStart()},e.ballSpot=ko.computed(function(){let a=!1,o=0,t=180,r=2;e.currentTeamWithBall()===e.homeTeamID()&&(a=!0,t=-4,r=175),o=a?t+1.8*(100-e.yardsToTouchdown())+1:1.8*e.yardsToTouchdown()-1;let n=1.8*e.yardsTraveled();if(a)$("#away-team-trail").css("width","0px"),$("#home-team-trail").css("background-image","linear-gradient(to right, rgba(255,255,255,0), rgba(255,255,255,1)"),$("#home-team-trail").css("width",n+"px"),$("#home-team-trail").css("margin-left",1.8*e.ballSpotStart()+"px"),console.log("HOME => yardsTraveled:"+e.yardsTraveled()+" ballSpotStart:"+e.ballSpotStart()+" trailWidth: "+n);else{let a=181-n-1.8*e.ballSpotStart();console.log("margin-width: "+a),$("#home-team-trail").css("width","0px"),$("#away-team-trail").css("background-image","linear-gradient(to left, rgba(255,255,255,0), rgba(255,255,255,1)"),$("#away-team-trail").css("width",n+"px"),$("#away-team-trail").css("margin-left",a+"px"),console.log("AWAY => yardsTraveled:"+e.yardsTraveled()+" ballSpotStart:"+e.ballSpotStart()+" trailWidth: "+n)}return console.log("=============="),console.log("yardsTraveled:"+e.yardsTraveled()+" ballSpotStart:"+e.ballSpotStart()),console.log("spot:"+o+" is home team:"+a+" max: "+r+" min: "+t),o}),e.AddPlayHistory=function(a){e.teamPlayHistory.push(a),e.teamPlayHistory.sort(function(e,a){return a.playId===e.playId?0:a.playId<e.playId?-1:1})},e.InitializeBoxScore=function(){let a=new MODULES.Constructors.GameBoxScoreRecord(e.homeTeamID(),e.homeTeamInfo().teamName(),0,0,0,0,0),o=new MODULES.Constructors.GameBoxScoreRecord(e.awayTeamID(),e.awayTeamInfo().teamName(),0,0,0,0,0);e.gameBoxScore.push(a),e.gameBoxScore.push(o)},e.UpdateBoxScore=function(){let a=e.currentQuarter(),o=$.grep(e.gameBoxScore(),function(a){return a.teamId===e.homeTeamID()})[0],t=$.grep(e.gameBoxScore(),function(a){return a.teamId===e.awayTeamID()})[0];e.gameBoxScore().length>0?(1===a&&(o.firstQuarterScore=e.homeTeamScore(),t.firstQuarterScore=e.awayTeamScore()),2===a&&(o.secondQuarterScore=e.homeTeamScore()-o.firstQuarterScore,t.secondQuarterScore=e.awayTeamScore()-t.firstQuarterScore),3===a&&(o.thirdQuarterScore=e.homeTeamScore()-o.firstQuarterScore-o.secondQuarterScore,t.thirdQuarterScore=e.awayTeamScore()-t.firstQuarterScore-t.secondQuarterScore),4===a&&(o.fourthQuarterScore=e.homeTeamScore()-o.firstQuarterScore-o.secondQuarterScore-o.thirdQuarterScore,t.fourthQuarterScore=e.awayTeamScore()-t.firstQuarterScore-t.secondQuarterScore-t.thirdQuarterScore),a>=5&&(o.overtimeScore=e.homeTeamScore()-o.firstQuarterScore-o.secondQuarterScore-o.thirdQuarterScore-o.fourthQuarterScore,t.overtimeScore=e.awayTeamScore()-t.firstQuarterScore-t.secondQuarterScore-t.thirdQuarterScore-t.fourthQuarterScore),e.gameBoxScore.refresh(o)):(console.log("ERROR: gameBoxScore array was never initialized. Initializing..."),e.InitializeBoxScore(),console.log("Updating Box Score..."),e.UpdateBoxScore())},e.InitializeGameStats=function(){let a=new MODULES.Constructors.GamePlayStatRecord(e.homeTeamID(),e.homeTeamInfo().teamName(),0,0,0,0,0,0),o=new MODULES.Constructors.GamePlayStatRecord(e.awayTeamID(),e.awayTeamInfo().teamName(),0,0,0,0,0,0);e.gamePlayStats.push(a),e.gamePlayStats.push(o)},e.UpdateGameStat=function(a){if(e.gamePlayStats().length>0){let o=$.grep(e.gamePlayStats(),function(e){return e.teamId===a.teamId})[0];o.totalPlayCount+=a.totalPlayCount,o.totalYardsRushing+=a.totalYardsRushing,o.totalYardsPassing+=a.totalYardsPassing,o.totalTimePossession+=a.totalTimePossession,o.totalTurnovers+=a.totalTurnovers,o.totalFirstDowns+=a.totalFirstDowns,e.gamePlayStats.refresh(o)}else console.log("ERROR: gamePlayStats array was never initialized. Initializing..."),e.InitializeGameStats(),console.log("Updating Box Score..."),e.UpdateGameStat()},e.RollDice=function(){gameDice.init(),e.hasRolled(!0)},e.CallTimeout=function(){console.log("TODO: Setup Timeout functionality."),e.currentTeamHasTimeOuts()?e.currentTeamWithBall()===e.awayTeamID()?e.awayTeamTimeOuts(e.awayTeamTimeOuts()-1):e.homeTeamTimeOuts(e.homeTeamTimeOuts()-1):alert("No Timeouts Remaining")},e.ResetGame=function(){gameStorage.clearLocalStorage()},e.SaveGame=function(){gameStorage.saveGame()},e.GetGameSaves=function(){gameStorage.getSavedData()},e.MakePlay=function(){playMaker.init(),$("input[name=selectPlay][value=pass]").prop("checked","checked")},e.MakePlayAfterTD=function(){playMaker.initPlayAfterTouchdown(),$("input[name=afterTDPlay][value=extraPoint]").prop("checked","checked")},e.SetupField=function(){console.log("SETTING UP FIELD"),$("#end-zone-left-img").addClass(e.homeTeamInfo().teamBgColor()),$("#end-zone-right-img").addClass(e.awayTeamInfo().teamBgColor()),$("#end-zone-left-txt").css("top",e.GetHomeTeamTextPosition(e.homeTeamInfo().teamName().length)+"%"),$("#end-zone-right-txt").css("top",e.GetAwayTeamTextPosition(e.awayTeamInfo().teamName().length)+"%"),e.SetBallPosition()},e.SetBallPosition=function(){console.log("SETTING BALL POSITION"),$("#ball-position-img").css("margin-left",e.ballSpot()+"px")},e.GetHomeTeamTextPosition=function(e){let a=58;switch(e){case 5:a=60;break;case 6:a=64;break;case 7:a=68;break;case 8:a=70;break;case 9:a=72;break;case 10:a=74}return a},e.GetAwayTeamTextPosition=function(e){let a=42;switch(e){case 5:a=40;break;case 6:a=36;break;case 7:a=34;break;case 8:a=30;break;case 9:a=28;break;case 10:a=26}return a},e.pointAttemptAfterTouchDown=ko.observable(!1),e.showKickoffControls=ko.observable(!0),e.isKickoff=ko.observable(!1),e.isSafety=ko.observable(!1),e.isPunt=ko.observable(!1),e.isFieldGoal=ko.observable(!1),e.isExtraPointKick=ko.observable(!1),e.coinTossValue=ko.observable(0).extend({throttle:4e3}),e.coinTossWinner=ko.observable(0),e.coinTossLoser=ko.observable(0),e.teamReceivingInitialKickoff=ko.observable(0),e.isBeginningOfHalf=!0,e.coinTossWinningOption=ko.observable("receive"),e.coinTossResultText=ko.computed(function(){return 1===e.coinTossValue()?"Heads":"Tails"}),e.coinTossWinnerInfo=ko.computed(function(){return e.coinTossWinner()===e.homeTeamID()?e.homeTeamInfo():e.awayTeamInfo()}),e.teamReceivingInitialKickoffInfo=ko.computed(function(){return e.teamReceivingInitialKickoff()===e.homeTeamID()?e.homeTeamInfo():e.awayTeamInfo()}),e.kickoffPowerSliderIntervalId=0,e.kickoffAngleSliderIntervalId=0,e.kickoffPower=-1,e.kickoffAngle=-1,e.TossCoin=function(){let a=getRandomInt(1,2),o=parseInt($("input[name=selectCoinSide]:checked").val(),10);$("#coin").unbind().click(function(){}),$("#coin").removeClass(),setTimeout(function(){1===a?$("#coin").addClass("heads"):$("#coin").addClass("tails")},100),e.coinTossValue(a),a===o?(e.coinTossWinner(e.awayTeamID()),e.coinTossLoser(e.homeTeamID())):(e.coinTossWinner(e.homeTeamID()),e.coinTossLoser(e.awayTeamID())),e.SelectCoinTossWinningOption()},e.SelectCoinTossWinningOption=function(){let a=$("input[name=selectCoinTossWinner]:checked").val();console.log("COIN TOSS WINNING OPTION: %s",a),e.coinTossWinningOption(a),"receive"===a?e.teamReceivingInitialKickoff(e.coinTossWinner()):e.teamReceivingInitialKickoff(e.coinTossLoser())},e.GetKickoffPower=function(){var a=parseInt($("#kickoffPower").val(),10);$("#kickoffPower").prop("disabled",!0),clearInterval(e.kickoffPowerSliderIntervalId),$("#kickoffPowerSelected").text(a),e.kickoffPower=a},e.GetKickoffAngle=function(){var a=parseInt($("#kickoffAngle").val(),10);$("#kickoffAngle").prop("disabled",!0),clearInterval(e.kickoffAngleSliderIntervalId),$("#kickoffAngleSelected").text(a),e.kickoffAngle=a},e.Kickoff=function(){console.log("kickoffPowerSelected: %s kickoffAngleSelected: %s",e.kickoffPower,e.kickoffAngle),e.kickoffPower>=0&&e.kickoffAngle>=0?playMaker.kickoff(kickoffPower,kickoffAngle):alert("Select kick power and angle")},e.SetupKickoff=function(){e.showKickoffControls(!0);let a=1,o=0;$("#kickoffPower").prop("disabled",!1),$("#kickoffAngle").prop("disabled",!1),e.kickoffPower=-1,e.kickoffAngle=-1,$("#kickoffAngleSelected").text("select angle"),$("#kickoffPowerSelected").text("select power"),e.SetupKickoffBallSpot(),e.kickoffPowerSliderIntervalId=window.setInterval(function(){$("#kickoffPower").val(o+=1*a),100===o&&(a=-1),0===o&&(a=1)},MODULES.GameVariables.KickoffSliderDifficulty),e.kickoffAngleSliderIntervalId=window.setInterval(function(){$("#kickoffAngle").val(o+=1*a),100===o&&(a=-1),0===o&&(a=1)},MODULES.GameVariables.KickoffSliderDifficulty)},e.ShowHideSpecialTeamsMenu=function(){4===e.currentDown()?$("#specialTeamsMenu").addClass(MODULES.Constants.SHOW_SPECIAL_TEAMS_CLASS):$("#specialTeamsMenu").removeClass(MODULES.Constants.SHOW_SPECIAL_TEAMS_CLASS)},e.ChangePossession=function(){e.yardsToFirst(10),e.currentDown(1),e.playCountForPossession(1),e.timeOfPossession(0),e.currentTeamWithBall()===e.awayTeamID()?e.currentTeamWithBall(e.homeTeamID()):e.currentTeamWithBall(e.awayTeamID())},e.PuntBall=function(){e.isPunt(!0),e.SetupKickoff()},e.KickFieldGoal=function(){e.isFieldGoal(!0),e.SetupKickoff()},e.SelectTeam=function(){let a=parseInt($("input[name=selectTeam]:checked").val(),10);a===e.homeTeamID()?alert("The away team must be different than the home team.  Please select a different team."):(e.ClearCoinColors(),"number"==typeof a&&(e.homeTeamID()?e.awayTeamID(a):e.homeTeamID(a)))},e.StartGame=function(){e.currentTeamWithBall(e.teamReceivingInitialKickoff()),e.pointAttemptAfterTouchDown(!1),e.SetupField(),e.isKickoff(!0),e.SetupKickoff(),e.gameStarted(!0),e.InitializeBoxScore(),e.InitializeGameStats()},e.ResetTeams=function(){e.ClearCoinColors(),e.homeTeamID(0),e.awayTeamID(0),console.log("TEAMS RESET")},e.ShowOtherGameInfo=function(){$("#gameInfoBox").is(":hidden")?$("#gameInfoBox").show("slow"):$("#gameInfoBox").slideUp()}}),$("#gameInfoBox").slideUp()});var gameDice={init:function(){gameDice.roll()},generateDie:function(e,a){let o={};return o.minValue=e,o.maxValue=a,o},getAllDice:function(){let e=[];for(var a=0;a<2;a++)e.push(gameDice.generateDie(1,6));return e},display:function(e,a){$("#diceValues").empty();for(var o=0,t=e.length;o<t;o++){let t=e[o],r=document.createElement("li"),n="Die "+(o+1)+" = "+t.valueRolled;r.appendChild(document.createTextNode(n)),$("#diceTotal").text(a),$("#diceValues").append(r)}},roll:function(){for(var e=gameDice.getAllDice(),a=0,o=0,t=e.length;o<t;o++){let t=e[o],r=getRandomInt(t.minValue,t.maxValue);t.valueRolled=r,a+=r}MODULES.GameVariables.DiceSumTotal=a,gameDice.display(e,a)}};function getRandomInt(e,a){return Math.floor(Math.random()*(a-e+1)+e)}function getNumberWithEnding(e){return e<=0?0:e%100==10||e%100==11||e%100==12||e%100==13||e%10==4||e%10==5||e%10==6||e%10==7||e%10==8||e%10==9||e%10==0?e.toString()+"th":e%10==1?e.toString()+"st":e%10==2?e.toString()+"nd":e%10==3?e.toString()+"rd":void 0}var playMaker={init:function(){playMaker.play()},initPlayAfterTouchdown:function(){playMaker.playAfterTouchdown()},display:function(e){$("#playResult").text(e),$("#playCount").text(MODULES.GameVariables.TotalPlayCount)},getPlayResult:function(e){let a=0,o=UTILITIES.splitAndTitleCase(e),t=!1,r=!1,n=getRandomInt(1,100)>=85,s=15,l=!1;self.playCountForPossession(self.playCountForPossession()+1),n&&(s=self.yardsToTouchdown()),MODULES.GameVariables.DiceSumTotal>=7&&(t=!0),MODULES.GameVariables.DiceSumTotal<=3&&(r=!0),e===GAME_PLAY_TYPES.TWOPOINTCONVERSION&&(l=!0,self.isKickoff(!0),self.SetupKickoff(),e===GAME_PLAY_TYPES.TWOPOINTCONVERSION&&MODULES.GameVariables.DiceSumTotal>=6?(a=getRandomInt(1,4))>=MODULES.Constants.TWO_POINT_CONVERSION_SPOT?(o+=" SUCCESSFUL",playMaker.addScore(SCORE_TYPES.TWOPOINTCONVERSION)):o+=" FAILED":e===GAME_PLAY_TYPES.TWOPOINTCONVERSION&&(o+=" FAILED")),t&&e===GAME_PLAY_TYPES.PASS&&(a=getRandomInt(1,s),o+=" Complete"),t&&e===GAME_PLAY_TYPES.RUN&&(a=getRandomInt(1,s),o+=" Successful"),r&&e===GAME_PLAY_TYPES.PASS&&(a=-1*getRandomInt(1,15),o="Sacked for a loss"),r&&e===GAME_PLAY_TYPES.RUN&&(a=-1*getRandomInt(1,15),o+=" - tackled for a loss"),t||r||e!==GAME_PLAY_TYPES.PASS||(o+=" Incomplete"),t||r||e!==GAME_PLAY_TYPES.RUN||(o+=" for no gain"),a>=self.yardsToTouchdown()&&(e===GAME_PLAY_TYPES.PASS||e===GAME_PLAY_TYPES.RUN)&&(o=SCORE_TYPES.TOUCHDOWN.toUpperCase(),playMaker.addScore(SCORE_TYPES.TOUCHDOWN),self.pointAttemptAfterTouchDown(!0)),self.yardsToTouchdown()>100&&(e===GAME_PLAY_TYPES.PASS||e===GAME_PLAY_TYPES.RUN)&&(o=SCORE_TYPES.SAFETY.toUpperCase(),playMaker.addScore(SCORE_TYPES.SAFETY),self.isSafety(!0),self.SetupKickoff(),l=!0),a>=self.yardsToFirst()&&(e===GAME_PLAY_TYPES.PASS||e===GAME_PLAY_TYPES.RUN)?(self.yardsToFirst(10),self.currentDown(1)):4===self.currentDown()?l=!0:(self.yardsToFirst(self.yardsToFirst()-a),self.currentDown(self.currentDown()+1)),console.log("YARDS: "+a);let i=new MODULES.Constructors.PlayResult(a,o,l,e);return"fieldGoal"!==e&&"extraPoint"!==e&&"twoPointConversion"!==e&&self.yardsTraveled(self.yardsTraveled()+a),self.SetBallPosition(),l&&(playMaker.recordPlay(i),a=0,self.ballSpotStart(self.yardsToTouchdown()),self.yardsTraveled(0),o+=" Change of Possession",self.ChangePossession()),self.ShowHideSpecialTeamsMenu(),i},kickoff:function(e,a){let o=getKickoffType(),t=convertKickoffPowerToYards(o,e,a),r=0,n=UTILITIES.splitAndTitleCase(o),s=MODULES.Constants.KICKOFF_SPOT,l=!1,i=!1,c=o===KICKOFF_TYPES.KICKOFF||o===KICKOFF_TYPES.ONSIDE||o===KICKOFF_TYPES.PUNT||o===KICKOFF_TYPES.SAFETY,m=getRandomInt(1,100);console.log("kickoffPower: %s, kickoffAngle: %s",e,a),(self.isPunt()||self.isFieldGoal())&&(s=self.currentBallSpot()),self.isSafety()&&(s=MODULES.Constants.SAFETY_KICKOFF_SPOT),self.isExtraPointKick()&&(s=MODULES.Constants.EXTRA_POINT_KICK_SPOT);let f=100-s,T=f+11;console.log("BEGINNING Kickoff Yards: %s, totalMaxKickWithoutTouchback: %s, BALL KICK OFF SPOT: %s",t,f,s);let S=self.awayTeamID(),u=self.homeTeamID();if(self.isBeginningOfHalf&&self.teamReceivingInitialKickoff()===self.homeTeamID()&&(S=self.homeTeamID(),u=self.awayTeamID()),self.isBeginningOfHalf=!1,self.isBeginningOfHalf||self.currentTeamWithBall()===self.homeTeamID()&&(S=self.homeTeamID(),u=self.awayTeamID()),o===KICKOFF_TYPES.ONSIDE){let o=!1;(o=e>=25&&(kickOffAngle<=20||a>=80))?(t=getRandomInt(10,20),getRandomInt(1,100)<=20?S=u:r=getRandomInt(1,100)<=5?getRandomInt(1,10):0):e<25?(t=35,n+=" Unsuccessful - Ball did not travel proper distance.",i=!0):a>20||a<80?(r=getRandomInt(1,t+s),n+=" Unsuccessful - Receiving team made a return."):(t=35,n+=" Unsuccessful - Ball went out of bounds.",i=!0)}else if(o===KICKOFF_TYPES.EXTRAPOINT||o===KICKOFF_TYPES.FIELDGOAL)m>6?t>f+MODULES.Constants.END_ZONE_YARDS?(n+=" GOOD",playMaker.addScore(o)):n+=" NO GOOD":n+=" Blocked";else if(console.log("HANDLE NORMAL KICKOFF/PUNT/SAFETY"),m<6&&o===KICKOFF_TYPES.PUNT)n+=" Blocked";else if(!(a<=20||a>=80)||o!==KICKOFF_TYPES.SAFETY&&o!==KICKOFF_TYPES.KICKOFF)if(t>=T)l=!0;else if(console.log("Kickoff Yards: %s, totalMaxKickWithoutTouchback: %s",t,f),t>=f)if(getRandomInt(1,100)>=85){let e=t-f,a=40,o=getRandomInt(1,100);console.log("Chance of big return: %s, Minimum Return Yards: %s, Maximum Return Yards: %s",o,e,a),r=getRandomInt(e,o>=90?a=t+s:a)}else l=!0;else console.log("Chance of normal return, Minimum Return Yards: %s, Maximum Return Yards: %s",1,t+s),r=getRandomInt(1,t+s);else t=35,n+=" Penalty - Ball kicked out of bounds.",i=!0;console.log("Kickoff type: %s, Kickoff distance: %s, kickoff return: %s, TeamID With Ball: %s",o,t,r,S);let d=new MODULES.Constructors.PlayResult(t,n);if(self.currentTeamWithBall(u),playMaker.recordPlay(d),c){let e="Kickoff Return";if(l||i)l&&(e+=" - TOUCHBACK",t=MODULES.Constants.TOUCHBACK_YARD_LINE),self.ballSpotStart(t);else{let e=100-s+t-r;console.log("BALL SPOT TOTAL: %s",e),self.ballSpotStart(100-e)}let a=new MODULES.Constructors.PlayResult(r,e);self.currentTeamWithBall(S),playMaker.recordPlay(a)}self.SetBallPosition(),playMaker.resetKickoffFlags(o)},resetKickoffFlags:function(e){self.showKickoffControls(!1),e===KICKOFF_TYPES.KICKOFF||e===KICKOFF_TYPES.ONSIDE?self.isKickoff(!1):e===KICKOFF_TYPES.EXTRAPOINT?self.isExtraPointKick(!1):e===KICKOFF_TYPES.SAFETY?self.isSafety(!1):e===KICKOFF_TYPES.FIELDGOAL?self.isFieldGoal(!1):e===KICKOFF_TYPES.PUNT&&self.isPunt(!1)},recordTimeOfPossession:function(e,a){let o=0;o+=5,e===GAME_PLAY_TYPES.RUN&&(o+=Math.round(a/2)),e===GAME_PLAY_TYPES.PASS&&(o+=2,o+=Math.round(a/10),o+=Math.round(a/4/2)),console.log("TIME OF POSSESSION: %s",self.timeOfPossession()),o=Math.round(o),self.timeOfPossession(o)},recordPlay:function(e){let a=$.grep(MODULES.GameVariables.Teams,function(e){return e.teamId===self.currentTeamWithBall()})[0],o="s";1!==e.yards&&-1!==e.yards||(o="");let t=e.yards.toString()+" Yard"+o;console.log("This Play:"+e.playResultText+" by the "+a.teamName()+" for "+t),self.AddPlayHistory(new MODULES.Constructors.PlayHistory(self.teamPlayHistory().length+1,self.currentTeamWithBall(),a.teamName(),HELPERS.getDownText(self.currentDown(),self.yardsToFirst()),self.playCountForPossession(),t,e.playResultText,HELPERS.getYardText())),playMaker.display(e.playResultText+" for "+e.yards.toString()+" Yard"+o),this.recordTimeOfPossession(e.playSelected,e.yards),this.recordGameStats(a,e)},recordGameStats:function(e,a){let o=new MODULES.Constructors.GamePlayStatRecord(e.teamId,e.teamName,1,0,0,self.timeOfPossession(),0,0);a.playType===GAME_PLAY_TYPES.RUN&&(o.totalYardsRushing=a.yards),a.playType===GAME_PLAY_TYPES.PASS&&(o.totalYardsPassing=a.yards),a.isTurnover&&(o.totalTurnovers=1),self.UpdateGameStat(o)},play:function(){let e=$("input[name=selectPlay]:checked").val();if(e){self.hasRolled(!1),$("#diceValues").empty();let a=playMaker.getPlayResult(e);playMaker.recordPlay(a),MODULES.GameVariables.TotalPlayCount+=1}else self.hasRolled(!0),alert("Choose a play")},playAfterTouchdown:function(){let e=$("input[name=afterTDPlay]:checked").val(),a=MODULES.Constants.EXTRA_POINT_KICK_SPOT;self.yardsTraveled(0),self.pointAttemptAfterTouchDown(!1),e===GAME_PLAY_TYPES.EXTRAPOINT?(self.isExtraPointKick(!0),self.SetupKickoff()):e===GAME_PLAY_TYPES.TWOPOINTCONVERSION&&(a=MODULES.Constants.TWO_POINT_CONVERSION_SPOT),self.ballSpotStart(a),self.SetBallPosition()},addScore:function(e){let a=0;switch(e){case SCORE_TYPES.TOUCHDOWN:a=6;break;case SCORE_TYPES.FIELDGOAL:a=3;break;case SCORE_TYPES.EXTRAPOINT:a=1;break;case SCORE_TYPES.SAFETY,SCORE_TYPES.TWOPOINTCONVERSION:a=2}currentTeamWithBall()===homeTeamID()?e===SCORE_TYPES.SAFETY?awayTeamScore(awayTeamScore()+a):homeTeamScore(homeTeamScore()+a):e===SCORE_TYPES.SAFETY?homeTeamScore(homeTeamScore()+a):awayTeamScore(awayTeamScore()+a),self.UpdateBoxScore()}};function getKickoffType(){let e=$("input[name=selectKickoffPlay]:checked").val();return self.isPunt()?e=KICKOFF_TYPES.PUNT:self.isFieldGoal()?e=KICKOFF_TYPES.FIELDGOAL:self.isSafety()?e=KICKOFF_TYPES.SAFETY:self.isExtraPointKick()&&(e=KICKOFF_TYPES.EXTRAPOINT),e}function convertKickoffPowerToYards(e,a,o){let t=0,r=0;if(e===KICKOFF_TYPES.EXTRAPOINT)r=a>=60?31:a>=40?29:a>=25?25:a;else if(e===KICKOFF_TYPES.ONSIDE)r=a>=90?getRandomInt(66,75):a>=85?65:a>=70?getRandomInt(50,64):a>=60?getRandomInt(40,50):a>=50?getRandomInt(30,40):a>=40?getRandomInt(20,30):a>=30?getRandomInt(10,20):getRandomInt(1,10);else if(e===KICKOFF_TYPES.PUNT)r=a;else if(e===KICKOFF_TYPES.FIELDGOAL){let e=0;self.yardsToTouchdown()>=40?e=1:self.yardsToTouchdown()>=30?e=2:self.yardsToTouchdown()>=20?e=4:self.yardsToTouchdown()>=10?e=6:self.yardsToTouchdown()>=5?e=8:self.yardsToTouchdown()>=4?e=9:self.yardsToTouchdown()>=1&&(e=10),r=a>=90?getRandomInt(60,70):a>=80?getRandomInt(50,60):a>=70?getRandomInt(40,50):a>=60?getRandomInt(30,40):a>=50?getRandomInt(20,30):a>=40?getRandomInt(10,20):getRandomInt(1,10),r+=e}else{let o=e===KICKOFF_TYPES.SAFETY?100-MODULES.Constants.SAFETY_KICKOFF_SPOT:100-MODULES.Constants.KICKOFF_SPOT;r=a>=98?o+11:a>=80?getRandomInt(o+1,o+10):a>=75?o:a>=70?getRandomInt(o-15,o-1):a>=60?getRandomInt(o-25,o-15):a>=50?getRandomInt(o-35,o-25):a>=40?getRandomInt(o-45,o-35):a>=30?getRandomInt(o-55,o-45):getRandomInt(1,o-55)}return o<=0||o>=100?t=Math.round(r/2.8):o<=10||o>=90?t=Math.round(r/3.8):o<=20||o>=80?t=Math.round(r/4.8):o<=30||o>=70?t=Math.round(r/5.8):(o<=40||o>=60)&&(t=Math.round(r/6.8)),console.log("KICKOFF: Type: %s, Power: %s, Angle: %s, Angle subtractor: %s, Yards: ",e,a,o,t,r),r-t}var gameStorage={storageAvailable:function(e){try{var a=window[e],o="__storage_test__";return a.setItem(o,o),a.removeItem(o),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==a.length}},clearLocalStorage:function(){localStorage.clear(),console.log("STORAGE CLEARED!")},populateStorage:function(e,a){localStorage.setItem(e,a),console.log(e+" saved a value of "+a)},getStorage:function(e){return localStorage.getItem(e)},getArrayStorage:function(e){return JSON.parse(localStorage.getItem(e))},saveGetData:function(e,a,o){o||!localStorage.getItem(e)?(gameStorage.populateStorage(e,a),console.log("item: %s, data: %s",e,a)):localStorage.getItem(e)&&gameStorage.getStorage(e)},getAllStorage:function(){console.log("========STORAGE=========");let e=gameStorage.getStorage("currentQuarter"),a=gameStorage.getStorage("currentDown"),o=gameStorage.getStorage("ballSpotStart"),t=gameStorage.getStorage("yardsTraveled"),r=gameStorage.getStorage("yardsToFirst"),n=gameStorage.getStorage("currentTeamWithBall"),s=gameStorage.getArrayStorage("teamPlayHistory"),l=gameStorage.getStorage("homeTeamID"),i=gameStorage.getStorage("homeTeamTimeOuts"),c=gameStorage.getStorage("homeTeamScore"),m=gameStorage.getStorage("awayTeamID"),f=gameStorage.getStorage("awayTeamTimeOuts"),T=gameStorage.getStorage("awayTeamScore");console.log("currentQuarter: "+e),console.log("currentDown: "+a),console.log("ballSpotStart: "+o),console.log("yardsTraveled: "+t),console.log("yardsToFirst: "+r),console.log("currentTeamWithBall: "+n),console.log("teamPlayHistory ARRAY: "+s),console.log("homeTeamID: "+l),console.log("homeTeamTimeOuts: "+i),console.log("homeTeamScore: "+c),console.log("awayTeamID: "+m),console.log("awayTeamTimeOuts: "+f),console.log("awayTeamScore: "+T),console.log("========END STORAGE========="),self.currentQuarter(e),self.currentDown(a),self.ballSpotStart(o),self.yardsTraveled(t),self.yardsToFirst(r),self.currentTeamWithBall(n),s&&self.teamPlayHistory(s),self.homeTeamID(l),self.homeTeamTimeOuts(i),self.homeTeamScore(c),self.awayTeamID(m),self.awayTeamTimeOuts(f),self.awayTeamScore(T)},saveGame:function(){gameStorage.saveGetData("currentQuarter",self.currentQuarter(),!0),gameStorage.saveGetData("currentDown",self.currentDown(),!0),gameStorage.saveGetData("ballSpotStart",self.ballSpotStart(),!0),gameStorage.saveGetData("yardsTraveled",self.yardsTraveled(),!0),gameStorage.saveGetData("yardsToFirst",self.yardsToFirst(),!0),gameStorage.saveGetData("currentTeamWithBall",self.currentTeamWithBall(),!0),gameStorage.saveGetData("teamPlayHistory",JSON.stringify(self.teamPlayHistory()),!0),gameStorage.saveGetData("homeTeamID",self.homeTeamID(),!0),gameStorage.saveGetData("homeTeamTimeOuts",self.homeTeamTimeOuts(),!0),gameStorage.saveGetData("homeTeamScore",self.homeTeamScore(),!0),gameStorage.saveGetData("awayTeamID",self.awayTeamID(),!0),gameStorage.saveGetData("awayTeamTimeOuts",self.awayTeamTimeOuts(),!0),gameStorage.saveGetData("awayTeamScore",self.awayTeamScore(),!0),gameStorage.getAllStorage()},getSavedData:function(){gameStorage.storageAvailable("localStorage")?gameStorage.getAllStorage():console.log("localStorage is not available")}};